---
title: "Coverage Assessment of Direct Nutrition Interventions in Liberia"
author: ""
date: #'`r Sys.Date()`'
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: xaringan-themer.css
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      warning = FALSE,
                      message = FALSE)

options(htmltools.dir.version = FALSE)

if(!require(remotes)) install.packages("remotes")
if(!require(magrittr)) install.packages("magrittr")
if(!require(leaflet)) install.packages("leaflet")
if(!require(RColorBrewer)) install.packages("RColorBrewer")
if(!require(rgdal)) install.packages("rgdal")
if(!require(rgeos)) install.packages("rgeos")
if(!require(raster)) install.packages("raster")
if(!require(xaringan)) install.packages("xaringan")
if(!require(ggplot2)) install.packages("ggplot2")
if(!require(cowplot)) install.packages("cowplot")
if(!require(tidyr)) install.packages("tidyr")

if(!require(liberia)) remotes::install_github("validmeasures/liberia")
if(!require(liberiaData)) remotes::install_github("validmeasures/liberiaData")
if(!require(xaringanthemer)) remotes::instal_github("gadenbuie/xaringanthemer")

mapbox.satellite <- "https://api.mapbox.com/styles/v1/mapbox/satellite-streets-v10/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiZXJuZXN0Z3VldmFycmEiLCJhIjoiejRRLXlZdyJ9.sqS1zi0rDH5CIzvcn9SXSg"
mapbox.street    <- "https://api.mapbox.com/styles/v1/mapbox/streets-v10/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiZXJuZXN0Z3VldmFycmEiLCJhIjoiejRRLXlZdyJ9.sqS1zi0rDH5CIzvcn9SXSg"
mapbox.dark      <- "https://api.mapbox.com/styles/v1/mapbox/dark-v9/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiZXJuZXN0Z3VldmFycmEiLCJhIjoiejRRLXlZdyJ9.sqS1zi0rDH5CIzvcn9SXSg"
mapbox.light     <- "https://api.mapbox.com/styles/v1/mapbox/light-v9/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiZXJuZXN0Z3VldmFycmEiLCJhIjoiejRRLXlZdyJ9.sqS1zi0rDH5CIzvcn9SXSg"
mapbox.moonlight <- "https://api.mapbox.com/styles/v1/ernestguevarra/cj3nban30001z2rpahc10c9ef/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiZXJuZXN0Z3VldmFycmEiLCJhIjoiejRRLXlZdyJ9.sqS1zi0rDH5CIzvcn9SXSg"
mapbox.northstar <- "https://api.mapbox.com/styles/v1/ernestguevarra/cj4ke832y4sng2spe2ds4fs55/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiZXJuZXN0Z3VldmFycmEiLCJhIjoiejRRLXlZdyJ9.sqS1zi0rDH5CIzvcn9SXSg"
mapbox.standard  <- "https://api.mapbox.com/styles/v1/ernestguevarra/cj5di36jn0gxg2rphjn3yetpt/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiZXJuZXN0Z3VldmFycmEiLCJhIjoiejRRLXlZdyJ9.sqS1zi0rDH5CIzvcn9SXSg"
mapbox.decimal   <- "https://api.mapbox.com/styles/v1/ernestguevarra/cj5ms1akt3pbi2smtcewsex9m/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiZXJuZXN0Z3VldmFycmEiLCJhIjoiejRRLXlZdyJ9.sqS1zi0rDH5CIzvcn9SXSg"
mapbox.terminal  <- "https://api.mapbox.com/styles/v1/ernestguevarra/cj6g0tzbd30kc2sph2wyh666m/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiZXJuZXN0Z3VldmFycmEiLCJhIjoiejRRLXlZdyJ9.sqS1zi0rDH5CIzvcn9SXSg"

monrovia <- subset(liberia::districts, admin2Name == "Greater Monrovia")
gmLng1 <- bbox(monrovia)[1, 1]
gmLat1 <- bbox(monrovia)[2, 1]
gmLng2 <- bbox(monrovia)[1, 2]
gmLat2 <- bbox(monrovia)[2, 2]

gmLng <- coordinates(monrovia)[1]
gmLat <- coordinates(monrovia)[2]

options(stringsAsFactors = FALSE)

themeSettings <- theme_bw() + 
  theme(
    panel.border = element_rect(size = 0.5, colour = "#85010C"),
    panel.grid.major = element_line(linetype = 1, 
                                    size = 0.2, 
                                    colour = "gray90"),
    panel.grid.minor = element_blank(),
    strip.background = element_blank(),
    strip.text = element_text(colour = "#247BA0", size = 15, hjust = 0),
    legend.key = element_rect(linetype = 0),
    axis.line.x = element_line(size = 1, colour = "#85010C"),
    axis.text.x = element_text(size = 12),
    axis.text.y = element_text(size = 12),
    axis.ticks = element_line(colour = "#85010C", size = 0.5)
  )

themeMapping <- theme_bw() + 
  theme(
    panel.border = element_rect(size = 0.5, colour = "#85010C"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    strip.background = element_blank(),
    strip.text.x = element_text(colour = "#247BA0", size = 12, hjust = 0),
    strip.text.y = element_text(colour = "#247BA0", size = 15, hjust = 0),
    legend.key = element_rect(linetype = 0),
    axis.text.x = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks = element_blank()
  )

map.palette <- colorRampPalette(colors = brewer.pal(n = 7, name = "RdYlGn"), 
                                space = "Lab")

ifaBaseGM    <- readOGR(dsn = "data/ifa", layer = "ifaPolyGM")
icfBaseGM    <- readOGR(dsn = "data/icf", layer = "icfPolyGM")
mnpBaseGM    <- readOGR(dsn = "data/mnp", layer = "mnpPolyGM")
vitBaseGM    <- readOGR(dsn = "data/vit", layer = "vitPolyGM")
screenBaseGM <- readOGR(dsn = "data/screen", layer = "screenPolyGM")
cmamBaseGM   <- readOGR(dsn = "data/cmam", layer = "coveragePolyGM")
nutBaseGM    <- readOGR(dsn = "data/nut", layer = "nutPolyGM")

ifaBaseGB    <- readOGR(dsn = "data/ifaPolyGB", layer = "ifaPolyGB")
icfBaseGB    <- readOGR(dsn = "data/icfPolyGB", layer = "icfPolyGB")
mnpBaseGB    <- readOGR(dsn = "data/mnpPolyGB", layer = "mnpPolyGB")
vitBaseGB    <- readOGR(dsn = "data/vitPolyGB", layer = "vitPolyGB")
screenBaseGB <- readOGR(dsn = "data/screenPolyGB", layer = "screenPolyGB")
cmamBaseGB   <- readOGR(dsn = "data/coveragePolyGB", layer = "coveragePolyGB")
nutBaseGB    <- readOGR(dsn = "data/nutPolyGB", layer = "nutPolyGB")

gmCovHex <- gmHexGrid
gmCovHex@data <- data.frame(gmCovHex@data, 
                            ifaInt[[1]], iycfInt[[1]], mnpInt[[1]], 
                            vitInt[[1]], screenInt[[1]], cmamInt[[1]], 
                            anthroInt[[1]])

gbCovHex <- gbHexGrid
gbCovHex@data <- data.frame(gbCovHex@data, 
                            ifaInt[[2]], iycfInt[[2]], mnpInt[[2]], 
                            vitInt[[2]], screenInt[[2]], cmamInt[[2]], 
                            anthroInt[[2]])
```

```{r xaringan-themer, include = FALSE}
xaringanthemer::mono_light(
  base_color = "#85010C", #CF070C",
  #title_slide_background_image = "https://www.validnutrition.org/wp-content/uploads/2017/07/Valid-Nutrition-CMAM.jpg",
  #title_slide_background_size = "cover",
  header_font_google = google_font("Lato"),
  text_font_google = google_font("EB Garamond"),
  text_color = "#2D2D2D",
  text_bold_color = "#247BA0",
  text_font_size = "1.5em",
  code_font_google = google_font("Fira Mono"),
  text_slide_number_font_size = "0.75em"
)
```

class: inverse, center, middle

## Valid International Ltd

www.validinternational.org

`r Sys.Date()`

---
# Outline

* Iron-folic acid supplementation coverage

* Infant and young child feeding counselling coverage

* Micronutrient powder supplementation coverage

* Vitamin A supplementation coverage

* Nutrition screening coverage

* CMAM coverage

---
background-color: #FFFFFF

## Iron-folic acid supplementation coverage

```{r ifa, echo = FALSE, eval = TRUE, fig.width = 12, fig.height = 7, fig.align = "center"}
## Baseline data
ifaEst <- read.csv("data/ifaEst.csv")
x <- ifaEst
x <- x[x$indicator %in% paste("ifa", 1:5, sep = ""), ]

varNames <- c("At least one ANC visit",
              "At least one ANC visit",
              "Know/heard about IFA",
              "Know/heard about IFA",
              "Received/purchased IFA",
              "Received/purchased IFA",
              "Consumed IFA",
              "Consumed IFA",
              "Consumed IFA for\n90 days or more",
              "Consumed IFA for\n90 days or more")

x <- data.frame(x[ , c("county", "indicator")], df = "ifaDF", varNames, x[ , c("estimate", "lcl", "ucl")])
names(x)[2] <- "varLabel"

x$county <- ifelse(x$county == "Monrovia", "Greater Monrovia", x$county)
x$varLabel <- ifelse(x$varLabel == "ifa5", "ifa6", x$varLabel)

x <- data.frame(round = "Baseline", x)

## Endline data
y <- ifaBoot[ifaBoot$varLabel %in% paste("ifa", c(1:4, 6), sep = ""), ]
y$varNames <- rep(unique(varNames), 2)

y <- data.frame(round = "Endline", y)

## Concatenate
ifaDF <- data.frame(rbind(x, y))

ifaDF$county <- factor(ifaDF$county, levels = c("Greater Monrovia", "Grand Bassa"))
ifaDF$varNames <- factor(ifaDF$varNames, levels = unique(varNames))

ggplot(data = ifaDF, mapping = aes(x = round, y = estimate * 100)) +
  geom_col(color = "#85010C", fill = "#85010C", width = 0.7, alpha = 0.7) +
  facet_grid(county ~ varNames) +
  labs(x = "", y = "%") +
  scale_y_continuous(limits = c(0, 100),
                     breaks = seq(from = 0, to = 100, by = 20)) +
  themeSettings +
  theme(strip.text.x = element_text(size = 12))
```
---
background-color: #FFFFFF

## IFA supplementation coverage Tanahashi plot

```{r ifaTanahashiPlot, echo = FALSE, eval = TRUE, fig.width = 12, fig.height = 8, fig.align = "center"}
ggplot(data = ifaDF, aes(x = varNames, y = estimate * 100, group = df)) +
  #geom_col(color = "#85010C", fill = "#85010C", width = 0.7, alpha = 0.7) +
  geom_area(mapping = aes(ymin = 0, ymax = estimate * 100),
            fill = "#247BA0", alpha = 0.5) +
  geom_path(colour = "#247BA0", size = 1.5, 
            lineend = "round", linejoin = "round") +
  geom_segment(mapping = aes(x = varNames, xend = varNames,
                             y = 0, yend = estimate * 100),
               size = 1, linetype = "solid", 
               lineend = "round", linejoin = "round",
               arrow = arrow(length = unit(0.15, "cm"),
                             ends = "both", type = "closed"),
               colour = "#85010C") +
  #geom_point(color = "#247BA0", fill = "#247BA0", 
  #           size = 4) +
  scale_y_continuous(limits = c(0, 100),
                     breaks = seq(from = 0, to = 100, by = 20)) +
  facet_grid(round ~ county) +
  labs(x = "", y = "%") +
  coord_flip() +
  themeSettings
```
---
background-color: #FFFFFF

## Reasons for not receiving/purchasing IFA supplementation

```{r ifa2plot, echo = FALSE, eval = TRUE, fig.width = 12, fig.height = 7, fig.align = "center"}
ifaEst <- read.csv("data/ifaEst.csv")
x <- ifaEst[ifaEst$indicator %in% paste("ifa3a.", 1:10, sep = "") & ifaEst$county == "Monrovia", ]
x$indicator <- factor(x = x$indicator, labels = c("Health centre ran out",
                                                  "Took too long to get tablets",
                                                  "Too expensive",
                                                  "Too far from clinic/hospital",
                                                  "No information where to get tablets",
                                                  "Did not go to hospital/clinic",
                                                  "Used traditional medicine",
                                                  "Not available to buy",
                                                  "Ebola time",
                                                  "Other"))

x <- x[x$estimate != 0, ]

baselineGM <- ggplot(data = x, aes(x = reorder(indicator, -estimate), y = estimate * 100)) +
  geom_col(col = "#993300", fill = alpha("#993300", 0.8), width = 0.7) +
  labs(x = "", y = "%") +
  scale_y_continuous(limits = c(0, 100), breaks = seq(from = 0, to = 100, by = 20)) +
  coord_flip() +
  themeSettings

x <- ifaBoot[ifaBoot$varLabel %in% paste("ifa3", letters[1:9], sep = "") & ifaBoot$county == "Greater Monrovia", ]
x$varLabel <- factor(x = x$varLabel, labels = c("Health centre ran out",
                                                "Took too long to get tablets",
                                                "Too expensive",
                                                "Did not go to hospital",
                                                "Don't know about iron-folic acid",
                                                "Didn't get any iron-folic acid",
                                                "Received but did not take",
                                                "Not interested",
                                                "No reason"))

x <- x[x$estimate != 0, ]

endlineGM <- ggplot(data = x, aes(x = reorder(varLabel, -estimate), y = estimate * 100)) +
  geom_col(col = "#993300", fill = alpha("#993300", 0.8), width = 0.7) +
  labs(x = "", y = "%") +
  scale_y_continuous(limits = c(0, 100), breaks = seq(from = 0, to = 100, by = 20)) + 
  coord_flip() +
  themeSettings

x <- ifaEst[ifaEst$indicator %in% paste("ifa3a.", 1:10, sep = "") & ifaEst$county == "Grand Bassa", ]
x$indicator <- factor(x = x$indicator, labels = c("Health centre ran out",
                                                  "Took too long to get tablets",
                                                  "Too expensive",
                                                  "Too far from clinic/ hospital",
                                                  "No information where to get tablets",
                                                  "Did not go to hospital/clinic",
                                                  "Used traditional medicine",
                                                  "Not available to buy",
                                                  "Ebola time",
                                                  "Other"))

x <- x[x$estimate != 0, ]

baselineGB <- ggplot(data = x, aes(x = reorder(indicator, -estimate), y = estimate * 100)) +
  geom_col(col = "#993300", fill = alpha("#993300", 0.8), width = 0.7) +
  labs(x = "", y = "%") +
  scale_y_continuous(limits = c(0, 100), breaks = seq(from = 0, to = 100, by = 20)) + 
  coord_flip() +
  themeSettings

x <- ifaBoot[ifaBoot$varLabel %in% paste("ifa3", letters[1:15], sep = "") & ifaBoot$county == "Grand Bassa", ]
x$varLabel <- factor(x = x$varLabel, labels = c("Health centre ran out",
                                                "Took too long to get tablets",
                                                "Too expensive",
                                                "Did not go to hospital",
                                                "Don't know about\niron-folic acid",
                                                "Didn't get any iron-folic acid",
                                                "Received but did not take",
                                                "Not interested",
                                                "No reason",
                                                "No money",
                                                "Not good",
                                                "Far from health centre/ hospital",
                                                "Not given tablets",
                                                "No time",
                                                "Don't like medicine"))

x <- x[x$estimate != 0, ]

endlineGB <- ggplot(data = x, aes(x = reorder(varLabel, -estimate), y = estimate * 100)) +
  geom_col(col = "#993300", fill = alpha("#993300", 0.8), width = 0.7) +
  labs(x = "", y = "%") +
  scale_y_continuous(limits = c(0, 100), breaks = seq(from = 0, to = 100, by = 20)) + 
  coord_flip() +
  themeSettings


plot_grid(baselineGM, endlineGM, baselineGB, endlineGB, 
          nrow = 2,  ncol = 2,
          labels = c("Baseline - Greater Monrovia", "Endline - Greater Monrovia",
                     "Baseline - Grand Bassa", "Endline - Grand Bassa"), 
          label_size = 12, label_colour = "#247BA0", 
          hjust = c(-1.4, -1.5, -1.85, -2),
          vjust = 1)
```

---
background-color: #FFFFFF

## Spatial distribution of IFA coverage in Greater Monrovia

```{r ifaMap, echo = FALSE, eval = TRUE, fig.width = 15, fig.height = 6, fig.align = "center"}
x <- subset(ifaBaseGM, select = c(county, ifa1, ifa2, ifa3, ifa4, ifa5))
names(x) <- c("county", "ifa1", "ifa2", "ifa3", "ifa4", "ifa5")
x@data <- data.frame(id = row.names(x), round = "Baseline", x@data)
xGeom <- fortify(x)
xGeom <- merge(xGeom, x@data, by = "id")

y <- subset(gmCovHex, select = c(county, ifa1, ifa2, ifa3, ifa4, ifa6))
names(y) <- c("county", "ifa1", "ifa2", "ifa3", "ifa4", "ifa5")
y@data <- data.frame(id = row.names(y), round = "Endline", y@data)
yGeom <- fortify(y)
yGeom <- merge(yGeom, y@data, by = "id")

xyGeom <- data.frame(rbind(xGeom, yGeom))
xyGeom <- pivot_longer(data = xyGeom, cols = ifa1:ifa5, names_to = "indicator", values_to = "estimate")

xyGeom$indicator <- factor(x = xyGeom$indicator,
                            labels = c("At least one ANC visit",
                                       "Know/heard about IFA",
                                       "Received/purchased IFA",
                                       "Consumed IFA",
                                       "Consumed IFA for 90 days or more"))

ggplot(data = xyGeom, 
       aes(x = long, y = lat, group = group, fill = estimate)) +
  geom_polygon() +
  scale_fill_gradientn(name = "%",
                       limits = c(0, 1), 
                       breaks = seq(from = 0, to = 1, by = .2),
                       labels = seq(from = 0, to = 100, by = 20),
                       colours = map.palette(101)) +
  scale_x_continuous(limits = bbox(greaterMonroviaEA)[1, ], 
                     breaks = seq(from = bbox(greaterMonroviaEA)[1, 1],
                                  to = bbox(greaterMonroviaEA)[1, 2],
                                  by = 0.01)) +
  scale_y_continuous(limits = bbox(greaterMonroviaEA)[2, ],
                     breaks = seq(from = bbox(greaterMonroviaEA)[2, 1],
                                  to = bbox(greaterMonroviaEA)[2, 2],
                                  by = 0.01)) +
  facet_grid(round ~ indicator) +
  labs(x = "", y = "") +
  themeMapping
```
---
background-color: #FFFFFF

## Spatial distribution of IFA coverage in Grand Bassa

```{r ifa2map, echo = FALSE, eval = TRUE, fig.width = 15, fig.height = 6, fig.align = "center"}
x <- subset(ifaBaseGB, select = c(county, ifa1, ifa2, ifa3, ifa4, ifa5))
names(x) <- c("county", "ifa1", "ifa2", "ifa3", "ifa4", "ifa5")
x@data <- data.frame(id = row.names(x), round = "Baseline", x@data)
xGeom <- fortify(x)
xGeom <- merge(xGeom, x@data, by = "id")

y <- subset(gbCovHex, select = c(county, ifa1, ifa2, ifa3, ifa4, ifa6))
names(y) <- c("county", "ifa1", "ifa2", "ifa3", "ifa4", "ifa5")
y@data <- data.frame(id = row.names(y), round = "Endline", y@data)
yGeom <- fortify(y)
yGeom <- merge(yGeom, y@data, by = "id")

xyGeom <- data.frame(rbind(xGeom, yGeom))
xyGeom <- pivot_longer(data = xyGeom, cols = ifa1:ifa5, names_to = "indicator", values_to = "estimate")

xyGeom$indicator <- factor(x = xyGeom$indicator,
                            labels = c("At least one ANC visit",
                                       "Know/heard about IFA",
                                       "Received/purchased IFA",
                                       "Consumed IFA",
                                       "Consumed IFA for 90 days or more"))

ggplot(data = xyGeom, 
       aes(x = long, y = lat, group = group, fill = estimate)) +
  geom_polygon() +
  scale_fill_gradientn(name = "%",
                       limits = c(0, 1), 
                       breaks = seq(from = 0, to = 1, by = .2),
                       labels = seq(from = 0, to = 100, by = 20),
                       colours = map.palette(101)) +
  scale_x_continuous(limits = bbox(grandBassaEA)[1, ], 
                     breaks = seq(from = bbox(grandBassaEA)[1, 1],
                                  to = bbox(grandBassaEA)[1, 2],
                                  by = 0.01)) +
  scale_y_continuous(limits = bbox(grandBassaEA)[2, ],
                     breaks = seq(from = bbox(grandBassaEA)[2, 1],
                                  to = bbox(grandBassaEA)[2, 2],
                                  by = 0.01)) +
  facet_grid(round ~ indicator) +
  labs(x = "", y = "") +
  themeMapping
```
---
background-color: #FFFFFF

## IYCF counselling

```{r icf1plot, echo = FALSE, eval = TRUE, fig.width = 8, fig.height = 6, fig.align = "center"}
icfEst <- read.csv("data/icfEst.csv")
x <- icfEst

x <- x[x$indicator %in% paste("icf", 1:2, sep = ""), ]

varNames <- c("Know/heard about IYCF counselling",
              "Know/heard about IYCF counselling",
              "Attended IYCF counselling",
              "Attended IYCF counselling")

x <- data.frame(x[ , c("county", "indicator")], df = "iycfDF", varNames, x[ , c("estimate", "lcl", "ucl")])
names(x)[2] <- "varLabel"

x$county <- ifelse(x$county == "Monrovia", "Greater Monrovia", x$county)

x <- data.frame(round = "Baseline", x)

## Endline data
y <- iycfBoot[iycfBoot$varLabel %in% paste("icf", 1:2, sep = ""), ]
y$varNames <- rep(unique(varNames), 2)

y <- data.frame(round = "Endline", y)

## Concatenate
iycfDF <- data.frame(rbind(x, y))

iycfDF$county <- factor(iycfDF$county, levels = c("Greater Monrovia", "Grand Bassa"))
iycfDF$varNames <- factor(iycfDF$varNames, levels = unique(varNames))

ggplot(data = iycfDF, mapping = aes(x = round, y = estimate * 100)) +
  geom_col(color = "#85010C", fill = "#85010C", width = 0.7, alpha = 0.7) +
  facet_grid(county ~ varNames) +
  labs(x = "", y = "%") +
  scale_y_continuous(limits = c(0, 100),
                     breaks = seq(from = 0, to = 100, by = 20)) +
  themeSettings +
  theme(strip.text.x = element_text(size = 12))
```
---
background-color: #FFFFFF

## Reasons for not attending IYCF counselling

```{r icf2plot, echo = FALSE, eval = TRUE, fig.width = 12, fig.height = 7, fig.align = "center"}
icfEst <- read.csv("data/icfEst.csv")
x <- icfEst[icfEst$indicator %in% paste("icf2a.", 1:11, sep = "") & icfEst$county == "Monrovia", ]
x$indicator <- factor(x = x$indicator, labels = c("Timing not convenient",
                                                  "Not interested",
                                                  "Do not trust counselor",
                                                  "Don't think I need it",
                                                  "Did not go to hospital/clinic", 
                                                  "During Ebola period", 
                                                  "IYCF counselling not available",
                                                  "No information on how\nto access counselling",
                                                  "No money to go to hospital",
                                                  "No time/too busy",
                                                  "Too far from clinic/hospital"))

x <- x[x$estimate != 0, ]

baselineGM <- ggplot(data = x, aes(x = reorder(indicator, -estimate), y = estimate * 100)) +
  geom_col(col = "#993300", fill = alpha("#993300", 0.8), width = 0.7) +
  labs(x = "", y = "%") +
  scale_y_continuous(limits = c(0, 100), breaks = seq(from = 0, to = 100, by = 20)) + 
  coord_flip() +
  themeSettings

x <- iycfBoot[iycfBoot$varLabel %in% paste("icf2", letters[1:7], sep = "") & iycfBoot$county == "Greater Monrovia", ]
x$varLabel <- factor(x = x$varLabel, labels = c("Timing not convenient",
                                                "Not interested",
                                                "Do not trust counselor",
                                                "Don't think I need it",
                                                "Did not go to hospital",
                                                "No one told me about it/\nnot invited",
                                                "No time"))

x <- x[x$estimate != 0, ]

endlineGM <- ggplot(data = x, aes(x = reorder(varLabel, -estimate), y = estimate * 100)) +
  geom_col(col = "#993300", fill = alpha("#993300", 0.8), width = 0.7) +
  labs(x = "", y = "%") +
  scale_y_continuous(limits = c(0, 100), breaks = seq(from = 0, to = 100, by = 20)) + 
  coord_flip() +
  themeSettings

x <- icfEst[icfEst$indicator %in% paste("icf2a.", 1:11, sep = "") & icfEst$county == "Grand Bassa", ]
x$indicator <- factor(x = x$indicator, labels = c("Timing not convenient",
                                                  "Not interested",
                                                  "Do not trust counselor",
                                                  "Don't think I need it",
                                                  "Did not go to hospital/clinic", 
                                                  "During Ebola period", 
                                                  "IYCF counselling not\navailable",
                                                  "No information on how\nto access counselling",
                                                  "No money to go to hospital",
                                                  "No time/too busy",
                                                  "Too far from clinic/hospital"))

x <- x[x$estimate != 0, ]

baselineGB <- ggplot(data = x, aes(x = reorder(indicator, -estimate), y = estimate * 100)) +
  geom_col(col = "#993300", fill = alpha("#993300", 0.8), width = 0.7) +
  labs(x = "", y = "%") +
  scale_y_continuous(limits = c(0, 100), breaks = seq(from = 0, to = 100, by = 20)) + 
  coord_flip() +
  themeSettings

x <- iycfBoot[iycfBoot$varLabel %in% paste("icf2", letters[1:14], sep = "") & iycfBoot$county == "Grand Bassa", ]
x$varLabel <- factor(x = x$varLabel, labels = c("Timing not convenient",
                                                "Not interested",
                                                "Do not trust counselor",
                                                "Don't think I need it",
                                                "Did not go to hospital",
                                                "No one told me about it/\nnot invited",
                                                "No time",
                                                "No interest",
                                                "Don't know about it",
                                                "Too far",
                                                "No money",
                                                "Carer not around",
                                                "Too weak to go",
                                                "Don't like medicine"))

x <- x[x$estimate != 0, ]

endlineGB <- ggplot(data = x, aes(x = reorder(varLabel, -estimate), y = estimate * 100)) +
  geom_col(col = "#993300", fill = alpha("#993300", 0.8), width = 0.7) +
  labs(x = "", y = "%") +
  scale_y_continuous(limits = c(0, 100), breaks = seq(from = 0, to = 100, by = 20)) + 
  coord_flip() +
  themeSettings

plot_grid(baselineGM, endlineGM, baselineGB, endlineGB,
          nrow = 2, ncol = 2,
          labels = c("Baseline - Greater Monrovia", "Endline - Greater Monrovia",
                     "Baseline - Grand Bassa", "Endline - Grand Bassa"),
          label_size = 12, label_colour = "#247BA0", 
          hjust = c(-1.4, -1.5, -1.85, -2),
          vjust = 1)
```
---
background-color: #FFFFFF

## Spatial distribution of IYCF counselling coverage in Greater Monrovia

```{r icf1map, echo = FALSE, eval = TRUE, fig.width = 6, fig.height = 6, fig.align = "center"}
x <- subset(icfBaseGM, select = c(county, icf1, icf2))
x@data <- data.frame(id = row.names(x), round = "Baseline", x@data)
xGeom <- fortify(x)
xGeom <- merge(xGeom, x@data, by = "id")

y <- subset(gmCovHex, select = c(county, icf1, icf2))
y@data <- data.frame(id = row.names(y), round = "Endline", y@data)
yGeom <- fortify(y)
yGeom <- merge(yGeom, y@data, by = "id")

xyGeom <- data.frame(rbind(xGeom, yGeom))
xyGeom <- pivot_longer(data = xyGeom, cols = icf1:icf2, names_to = "indicator", values_to = "estimate")

xyGeom$indicator <- factor(x = xyGeom$indicator,
                          labels = c("Know about IYCF counselling",
                                     "Attended IYCF counselling"))

ggplot(data = xyGeom, 
       aes(x = long, y = lat, group = group, fill = estimate)) +
  geom_polygon() +
  scale_fill_gradientn(name = "%",
                       limits = c(0, 1), 
                       breaks = seq(from = 0, to = 1, by = .2),
                       labels = seq(from = 0, to = 100, by = 20),
                       colours = map.palette(101)) +
  scale_x_continuous(limits = bbox(greaterMonroviaEA)[1, ], 
                     breaks = seq(from = bbox(greaterMonroviaEA)[1, 1],
                                  to = bbox(greaterMonroviaEA)[1, 2],
                                  by = 0.01)) +
  scale_y_continuous(limits = bbox(greaterMonroviaEA)[2, ],
                     breaks = seq(from = bbox(greaterMonroviaEA)[2, 1],
                                  to = bbox(greaterMonroviaEA)[2, 2],
                                  by = 0.01)) +
  facet_grid(round ~ indicator) +
  labs(x = "", y = "") +
  themeMapping
```
---
background-color: #FFFFFF

## Spatial distribution of IYCF counselling coverage in Grand Bassa

```{r icf2map, echo = FALSE, eval = TRUE, fig.width = 6, fig.height = 6, fig.align = "center"}
x <- subset(icfBaseGB, select = c(county, icf1, icf2))
x@data <- data.frame(id = row.names(x), round = "Baseline", x@data)
xGeom <- fortify(x)
xGeom <- merge(xGeom, x@data, by = "id")

y <- subset(gbCovHex, select = c(county, icf1, icf2))
y@data <- data.frame(id = row.names(y), round = "Endline", y@data)
yGeom <- fortify(y)
yGeom <- merge(yGeom, y@data, by = "id")

xyGeom <- data.frame(rbind(xGeom, yGeom))
xyGeom <- pivot_longer(data = xyGeom, cols = icf1:icf2, names_to = "indicator", values_to = "estimate")

xyGeom$indicator <- factor(x = xyGeom$indicator,
                          labels = c("Know about IYCF counselling",
                                     "Attended IYCF counselling"))

ggplot(data = xyGeom, 
       aes(x = long, y = lat, group = group, fill = estimate)) +
  geom_polygon() +
  scale_fill_gradientn(name = "%",
                       limits = c(0, 1), 
                       breaks = seq(from = 0, to = 1, by = .2),
                       labels = seq(from = 0, to = 100, by = 20),
                       colours = map.palette(101)) +
  scale_x_continuous(limits = bbox(grandBassaEA)[1, ], 
                     breaks = seq(from = bbox(grandBassaEA)[1, 1],
                                  to = bbox(grandBassaEA)[1, 2],
                                  by = 0.01)) +
  scale_y_continuous(limits = bbox(grandBassaEA)[2, ],
                     breaks = seq(from = bbox(grandBassaEA)[2, 1],
                                  to = bbox(grandBassaEA)[2, 2],
                                  by = 0.01)) +
  facet_grid(round ~ indicator) +
  labs(x = "", y = "") +
  themeMapping
```
---
background-color: #FFFFFF

## Micronutrient powder supplementation coverage

```{r mnp1plot, echo = FALSE, eval = TRUE, fig.height = 7, fig.width = 12, fig.align = "center"}
mnpEst <- read.csv("data/mnpEst.csv")
x <- mnpEst

x <- x[x$indicator %in% paste("mnp", 1:3, sep = ""), ]

varNames <- c("Heard about micronutrient powder",
              "Heard about micronutrient powder",
              "Received/purchased micronutrient powder",
              "Received/purchased micronutrient powder",
              "Child consumed micronutrient powder",
              "Child consumed micronutrient powder")

x <- data.frame(x[ , c("county", "indicator")], df = "mnpDF", varNames, x[ , c("estimate", "lcl", "ucl")])
names(x)[2] <- "varLabel"

x$county <- ifelse(x$county == "Monrovia", "Greater Monrovia", x$county)

x <- data.frame(round = "Baseline", x)

## Endline data
y <- mnpBoot[mnpBoot$varLabel %in% paste("mnp", 1:3, sep = ""), ]
y$varNames <- rep(unique(varNames), 2)

y <- data.frame(round = "Endline", y)

## Concatenate
mnpDF <- data.frame(rbind(x, y))

mnpDF$county <- factor(mnpDF$county, levels = c("Greater Monrovia", "Grand Bassa"))
mnpDF$varNames <- factor(mnpDF$varNames, levels = unique(varNames))

ggplot(data = mnpDF, mapping = aes(x = round, y = estimate * 100)) +
  geom_col(color = "#85010C", fill = "#85010C", width = 0.7, alpha = 0.7) +
  facet_grid(county ~ varNames) +
  labs(x = "", y = "%") +
  scale_y_continuous(limits = c(0, 100),
                     breaks = seq(from = 0, to = 100, by = 20)) +
  themeSettings +
  theme(strip.text.x = element_text(size = 12))
```
---
background-color: #FFFFFF

## Reasons for not receiving micronutrient powder

```{r mnp2plot, echo = FALSE, eval = TRUE, fig.width = 12, fig.height = 7, fig.align = "center"}
mnpEst <- read.csv("data/mnpEst.csv")
x <- mnpEst[mnpEst$indicator %in% paste("mnp2a.", 1:10, sep = "") & mnpEst$county == "Monrovia", ]
x$indicator <- factor(x = x$indicator, labels = c("Health centre ran out",
                                                  "Took too long to get\nmicronutrient powder",
                                                  "Too expensive",
                                                  "Child doesn't need it",
                                                  "Heard it doesn't work/help",
                                                  "Did not receive micronutrient powder/\nnot in programme",
                                                  "Micronutrient powder not available",
                                                  "Mother/child was sick",
                                                  "Never asked for it",
                                                  "No information on how to access\nmicronutrient powder"))

x <- x[x$estimate != 0, ]

baselineGM <- ggplot(data = x, aes(x = reorder(indicator, -estimate), y = estimate * 100)) +
  geom_col(col = "#993300", fill = alpha("#993300", 0.8), width = 0.7) +
  labs(x = "", y = "%") +
  scale_y_continuous(limits = c(0, 100), breaks = seq(from = 0, to = 100, by = 20)) + 
  coord_flip() +
  themeSettings

x <- mnpBoot[mnpBoot$varLabel %in% paste("mnp2", letters[1:9], sep = "") & mnpBoot$county == "Greater Monrovia", ]
x$varLabel <- factor(x = x$varLabel, labels = c("Health centre ran out",
                                                "Took too long to get\nmicronutrient powder",
                                                "Too expensive",
                                                "Child doesn't need it",
                                                "Heard it doesn't work/help",
                                                "Don't know/not seen/not heard of\nmicronutrient powder",
                                                "Have not gone to hospital",
                                                "Have not received any\nfrom hospital/centre",
                                                "Hospital didn't tell me about it"))

x <- x[x$estimate != 0, ]

endlineGM <- ggplot(data = x, aes(x = reorder(varLabel, -estimate), y = estimate * 100)) +
  geom_col(col = "#993300", fill = alpha("#993300", 0.8), width = 0.7) +
  labs(x = "", y = "%") +
  scale_y_continuous(limits = c(0, 100), breaks = seq(from = 0, to = 100, by = 20)) + 
  coord_flip() +
  themeSettings

x <- mnpEst[mnpEst$indicator %in% paste("mnp2a.", 1:10, sep = "") & mnpEst$county == "Grand Bassa", ]
x$indicator <- factor(x = x$indicator, labels = c("Health centre ran out",
                                                  "Took too long to get\nmicronutrient powder",
                                                  "Too expensive",
                                                  "Child doesn't need it",
                                                  "Heard it doesn't work/help",
                                                  "Did not receive micronutrient powder/\nnot in programme",
                                                  "Micronutrient powder\nnot available",
                                                  "Mother/child was sick",
                                                  "Never asked for it",
                                                  "No information on how to access\nmicronutrient powder"))

x <- x[x$estimate != 0, ]

baselineGB <- ggplot(data = x, aes(x = reorder(indicator, -estimate), y = estimate * 100)) +
  geom_col(col = "#993300", fill = alpha("#993300", 0.8), width = 0.7) +
  labs(x = "", y = "%") +
  scale_y_continuous(limits = c(0, 100), breaks = seq(from = 0, to = 100, by = 20)) + 
  coord_flip() +
  themeSettings

x <- mnpBoot[mnpBoot$varLabel %in% paste("mnp2", letters[1:17], sep = "") & mnpBoot$county == "Grand Bassa", ]
x$varLabel <- factor(x = x$varLabel, labels = c("Health centre ran out",
                                                "Took too long to get\nmicronutrient powder",
                                                "Too expensive",
                                                "Child doesn't need it",
                                                "Heard it doesn't work/help",
                                                "Don't know/not seen/not heard of\nmicronutrient powder",
                                                "Have not gone to hospital",
                                                "Have not received any\nfrom hospital/centre",
                                                "Hospital didn't tell me about it",
                                                "Child not sick/healthy/\ndoesn't need it",
                                                "Child doesn't want to take it",
                                                "Too far",
                                                "Don't want it/not interested",
                                                "Hospital doesn't have it",
                                                "Mother not around",
                                                "No means",
                                                "Mother pregnant at the time"))

x <- x[x$estimate != 0, ]

endlineGB <- ggplot(data = x, aes(x = reorder(varLabel, -estimate), y = estimate * 100)) +
  geom_col(col = "#993300", fill = alpha("#993300", 0.8), width = 0.7) +
  labs(x = "", y = "%") +
  scale_y_continuous(limits = c(0, 100), breaks = seq(from = 0, to = 100, by = 20)) + 
  coord_flip() +
  themeSettings +
  theme(axis.text.y = element_text(size = 9))

plot_grid(baselineGM, endlineGM, baselineGB, endlineGB,
          nrow = 2, ncol = 2,
          labels = c("Baseline - Greater Monrovia", "Endline - Greater Monrovia",
                     "Baseline - Grand Bassa", "Endline - Grand Bassa"),
          label_size = 12, label_colour = "#247BA0", 
          hjust = c(-1.4, -1.5, -1.85, -2),
          vjust = 1)
```
---
background-color: #FFFFFF

## Spatial distribution of MNP supplementation coverage in Greater Monrovia

```{r mnp1Map, echo = FALSE, eval = TRUE, fig.width = 9, fig.height = 6, fig.align = "center"}
x <- subset(mnpBaseGM, select = c(county, mnp1, mnp2, mnp3))
x@data <- data.frame(id = row.names(x), round = "Baseline", x@data)
xGeom <- fortify(x)
xGeom <- merge(xGeom, x@data, by = "id")

y <- subset(gmCovHex, select = c(county, mnp1, mnp2, mnp3))
y@data <- data.frame(id = row.names(y), round = "Endline", y@data)
yGeom <- fortify(y)
yGeom <- merge(yGeom, y@data, by = "id")

xyGeom <- data.frame(rbind(xGeom, yGeom))
xyGeom <- pivot_longer(data = xyGeom, cols = mnp1:mnp3, names_to = "indicator", values_to = "estimate")

xyGeom$indicator <- factor(x = xyGeom$indicator,
                          labels = c("Heard about MNP",
                                     "Received/purchased MNP",
                                     "Child consumed MNP"))

ggplot(data = xyGeom, 
       aes(x = long, y = lat, group = group, fill = estimate)) +
  geom_polygon() +
  scale_fill_gradientn(name = "%",
                       limits = c(0, 1), 
                       breaks = seq(from = 0, to = 1, by = .2),
                       labels = seq(from = 0, to = 100, by = 20),
                       colours = map.palette(101)) +
  scale_x_continuous(limits = bbox(greaterMonroviaEA)[1, ], 
                     breaks = seq(from = bbox(greaterMonroviaEA)[1, 1],
                                  to = bbox(greaterMonroviaEA)[1, 2],
                                  by = 0.01)) +
  scale_y_continuous(limits = bbox(greaterMonroviaEA)[2, ],
                     breaks = seq(from = bbox(greaterMonroviaEA)[2, 1],
                                  to = bbox(greaterMonroviaEA)[2, 2],
                                  by = 0.01)) +
  facet_grid(round ~ indicator) +
  labs(x = "", y = "") +
  themeMapping
```
---
background-color: #FFFFFF

## Spatial distribution of MNP supplementation coverage in Grand Bassa

```{r mnp2map, echo = FALSE, eval = TRUE, fig.width = 9, fig.height = 6, fig.align = "center"}
x <- subset(mnpBaseGB, select = c(county, mnp1, mnp2, mnp3))
x@data <- data.frame(id = row.names(x), round = "Baseline", x@data)
xGeom <- fortify(x)
xGeom <- merge(xGeom, x@data, by = "id")

y <- subset(gbCovHex, select = c(county, mnp1, mnp2, mnp3))
y@data <- data.frame(id = row.names(y), round = "Endline", y@data)
yGeom <- fortify(y)
yGeom <- merge(yGeom, y@data, by = "id")

xyGeom <- data.frame(rbind(xGeom, yGeom))
xyGeom <- pivot_longer(data = xyGeom, cols = mnp1:mnp3, names_to = "indicator", values_to = "estimate")

xyGeom$indicator <- factor(x = xyGeom$indicator,
                          labels = c("Heard about MNP",
                                     "Received/purchased MNP",
                                     "Child consumed MNP"))

ggplot(data = xyGeom, 
       aes(x = long, y = lat, group = group, fill = estimate)) +
  geom_polygon() +
  scale_fill_gradientn(name = "%",
                       limits = c(0, 1), 
                       breaks = seq(from = 0, to = 1, by = .2),
                       labels = seq(from = 0, to = 100, by = 20),
                       colours = map.palette(101)) +
  scale_x_continuous(limits = bbox(grandBassaEA)[1, ], 
                     breaks = seq(from = bbox(grandBassaEA)[1, 1],
                                  to = bbox(grandBassaEA)[1, 2],
                                  by = 0.01)) +
  scale_y_continuous(limits = bbox(grandBassaEA)[2, ],
                     breaks = seq(from = bbox(grandBassaEA)[2, 1],
                                  to = bbox(grandBassaEA)[2, 2],
                                  by = 0.01)) +
  facet_grid(round ~ indicator) +
  labs(x = "", y = "") +
  themeMapping
```
---
background-color: #FFFFFF

## Vitamin A supplementation coverage

```{r vit1plot, echo = FALSE, eval = TRUE, fig.height = 6, fig.width = 4, fig.align = "center"}
vitEst <- read.csv("data/vitEst.csv")
x <- vitEst

x <- x[x$indicator == "vit1", ]

varNames <- rep("Received vitamin A in the past 6 months", 2)

x <- data.frame(x[ , c("county", "indicator")], df = "vitDF", varNames, x[ , c("estimate", "lcl", "ucl")])
names(x)[2] <- "varLabel"

x$county <- ifelse(x$county == "Monrovia", "Greater Monrovia", x$county)

x <- data.frame(round = "Baseline", x)

## Endline data
y <- vitBoot[vitBoot$varLabel == "vit1", ]
y$varNames <- varNames

y <- data.frame(round = "Endline", y)

## Concatenate
vitDF <- data.frame(rbind(x, y))

vitDF$county <- factor(vitDF$county, levels = c("Greater Monrovia", "Grand Bassa"))
vitDF$varNames <- factor(vitDF$varNames, levels = unique(varNames))

ggplot(data = vitDF, mapping = aes(x = round, y = estimate * 100)) +
  geom_col(color = "#85010C", fill = "#85010C", width = 0.7, alpha = 0.7) +
  facet_grid(county ~ varNames) +
  labs(x = "", y = "%") +
  scale_y_continuous(limits = c(0, 100),
                     breaks = seq(from = 0, to = 100, by = 20)) +
  themeSettings +
  theme(strip.text.x = element_text(size = 12))
```
---
background-color: #FFFFFF

## Spatial distribution of vitamin A supplementation coverage in Greater Monrovia

```{r vit1map, echo = FALSE, eval = TRUE, fig.width = 8, fig.height = 4, fig.align = "center"}
x <- subset(vitBaseGM, select = c(county, vit1))
x@data <- data.frame(id = row.names(x), round = "Baseline", x@data)
xGeom <- fortify(x)
xGeom <- merge(xGeom, x@data, by = "id")

y <- subset(gmCovHex, select = c(county, vit1))
y@data <- data.frame(id = row.names(y), round = "Endline", y@data)
yGeom <- fortify(y)
yGeom <- merge(yGeom, y@data, by = "id")

xyGeom <- data.frame(rbind(xGeom, yGeom))
#xyGeom <- pivot_longer(data = xyGeom, cols = mnp1:mnp3, names_to = "indicator", values_to = "estimate")

#xyGeom$indicator <- factor(x = xyGeom$indicator,
#                          labels = "Received vitamin A in the past 6 months")

ggplot(data = xyGeom, 
       aes(x = long, y = lat, group = group, fill = vit1)) +
  geom_polygon() +
  scale_fill_gradientn(name = "%",
                       limits = c(0, 1), 
                       breaks = seq(from = 0, to = 1, by = .2),
                       labels = seq(from = 0, to = 100, by = 20),
                       colours = map.palette(101)) +
  scale_x_continuous(limits = bbox(greaterMonroviaEA)[1, ], 
                     breaks = seq(from = bbox(greaterMonroviaEA)[1, 1],
                                  to = bbox(greaterMonroviaEA)[1, 2],
                                  by = 0.01)) +
  scale_y_continuous(limits = bbox(greaterMonroviaEA)[2, ],
                     breaks = seq(from = bbox(greaterMonroviaEA)[2, 1],
                                  to = bbox(greaterMonroviaEA)[2, 2],
                                  by = 0.01)) +
  facet_grid(. ~ round) +
  labs(x = "", y = "") +
  themeMapping
```
---
background-color: #FFFFFF

## Spatial distribution of vitamin A supplementation coverage in Grand Bassa

```{r vit2map, echo = FALSE, eval = TRUE, fig.width = 8, fig.height = 4, fig.align = "center"}
x <- subset(vitBaseGB, select = c(county, vit1))
x@data <- data.frame(id = row.names(x), round = "Baseline", x@data)
xGeom <- fortify(x)
xGeom <- merge(xGeom, x@data, by = "id")

y <- subset(gbCovHex, select = c(county, vit1))
y@data <- data.frame(id = row.names(y), round = "Endline", y@data)
yGeom <- fortify(y)
yGeom <- merge(yGeom, y@data, by = "id")

xyGeom <- data.frame(rbind(xGeom, yGeom))
#xyGeom <- pivot_longer(data = xyGeom, cols = mnp1:mnp3, names_to = "indicator", values_to = "estimate")

#xyGeom$indicator <- factor(x = xyGeom$indicator,
#                          labels = "Received vitamin A in the past 6 months")

ggplot(data = xyGeom, 
       aes(x = long, y = lat, group = group, fill = vit1)) +
  geom_polygon() +
  scale_fill_gradientn(name = "%",
                       limits = c(0, 1), 
                       breaks = seq(from = 0, to = 1, by = .2),
                       labels = seq(from = 0, to = 100, by = 20),
                       colours = map.palette(101)) +
  scale_x_continuous(limits = bbox(grandBassaEA)[1, ], 
                     breaks = seq(from = bbox(grandBassaEA)[1, 1],
                                  to = bbox(grandBassaEA)[1, 2],
                                  by = 0.01)) +
  scale_y_continuous(limits = bbox(grandBassaEA)[2, ],
                     breaks = seq(from = bbox(grandBassaEA)[2, 1],
                                  to = bbox(grandBassaEA)[2, 2],
                                  by = 0.01)) +
  facet_grid(. ~ round) +
  labs(x = "", y = "") +
  themeMapping
```
---
background-color: #FFFFFF

## Reasons for not receiving vitamin A

```{r vit2plot, echo = FALSE, eval = TRUE, fig.height = 7, fig.width = 12, fig.align = "center"}
vitEst <- read.csv("data/vitEst.csv")
x <- vitEst[vitEst$indicator %in% paste("vit1a.", 1:11, sep = "") & vitEst$county == "Monrovia", ]
x$indicator <- factor(x = x$indicator, labels = c("Health centre ran out",
                                                  "Took too long to get\nmicronutrient powder",
                                                  "Child doesn't need it",
                                                  "Heard it doesn't work/help",
                                                  "Child just reached 6 months old",
                                                  "Did not go to hospital/clinic",
                                                  "No information on how to get vitamin A",
                                                  "Not around during vaccination",
                                                  "Not given vitamin A",
                                                  "Not reached by vaccination team",
                                                  "Too far from clinic/hospital"))

x <- x[x$estimate != 0, ]

baselineGM <- ggplot(data = x, aes(x = reorder(indicator, -estimate), y = estimate * 100)) +
  geom_col(col = "#993300", fill = alpha("#993300", 0.8), width = 0.7) +
  labs(x = "", y = "%") +
  scale_y_continuous(limits = c(0, 100), breaks = seq(from = 0, to = 100, by = 20)) +
  coord_flip() +
  themeSettings

x <- vitBoot[vitBoot$varLabel %in% paste("vit1", letters[1:10], sep = "") & vitBoot$county == "Greater Monrovia", ]
x$varLabel <- factor(x = x$varLabel, labels = c("Health centre ran out",
                                                "Took too long to get drops",
                                                "Child doesn't need it",
                                                "Heard it doesn't work/help",
                                                "Child too young during last campaign",
                                                "Not around during last campaign",
                                                "Didn't hear/know about it",
                                                "Never been to hospital",
                                                "Vaccine team didn't come/reach",
                                                "Not interested"))

x <- x[x$estimate != 0, ]
x <- x[!is.na(x$estimate), ]


endlineGM <- ggplot(data = x, aes(x = reorder(varLabel, -estimate), y = estimate * 100)) +
  geom_col(col = "#993300", fill = alpha("#993300", 0.8), width = 0.7) +
  labs(x = "", y = "%") +
  scale_y_continuous(limits = c(0, 100), breaks = seq(from = 0, to = 100, by = 20)) + 
  coord_flip() +
  themeSettings

x <- vitEst[vitEst$indicator %in% paste("vit1a.", 1:11, sep = "") & vitEst$county == "Grand Bassa", ]
x$indicator <- factor(x = x$indicator, labels = c("Health centre ran out",
                                                  "Took too long to get\nmicronutrient powder",
                                                  "Child doesn't need it",
                                                  "Heard it doesn't work/help",
                                                  "Child just reached 6 months old",
                                                  "Did not go to hospital/clinic",
                                                  "No information on how to get vitamin A",
                                                  "Not around during vaccination",
                                                  "Not given vitamin A",
                                                  "Not reached by vaccination team",
                                                  "Too far from clinic/hospital"))

x <- x[x$estimate != 0, ]

baselineGB <- ggplot(data = x, aes(x = reorder(indicator, -estimate), y = estimate * 100)) +
  geom_col(col = "#993300", fill = alpha("#993300", 0.8), width = 0.7) +
  labs(x = "", y = "%") +
  scale_y_continuous(limits = c(0, 100), breaks = seq(from = 0, to = 100, by = 20)) + 
  coord_flip() +
  themeSettings

x <- vitBoot[vitBoot$varLabel %in% paste("vit1", letters[1:15], sep = "") & vitBoot$county == "Grand Bassa", ]
x$varLabel <- factor(x = x$varLabel, labels = c("Health centre ran out",
                                                "Took too long to get drops",
                                                "Child doesn't need it",
                                                "Heard it doesn't work/help",
                                                "Child too young during last campaign",
                                                "Not around during last campaign",
                                                "Didn't hear/know about it",
                                                "Never been to hospital",
                                                "Vaccine team didn't come/reach",
                                                "Not interested",
                                                "Too far",
                                                "No facility",
                                                "No means/money",
                                                "No time",
                                                "Waiting for next campaign"))

x <- x[x$estimate != 0, ]
x <- x[!is.na(x$estimate), ]

endlineGB <- ggplot(data = x, aes(x = reorder(varLabel, -estimate), y = estimate * 100)) +
  geom_col(col = "#993300", fill = alpha("#993300", 0.8), width = 0.7) +
  labs(x = "", y = "%") +
  scale_y_continuous(limits = c(0, 100), breaks = seq(from = 0, to = 100, by = 20)) + 
  coord_flip() +
  themeSettings

plot_grid(baselineGM, endlineGM, baselineGB, endlineGB,
          nrow = 2, ncol = 2,
          labels = c("Baseline - Greater Monrovia", "Endline - Greater Monrovia",
                     "Baseline - Grand Bassa", "Endline - Grand Bassa"),
          label_size = 12, label_colour = "#247BA0", 
          hjust = c(-1.4, -1.5, -1.85, -2),
          vjust = 1)
```
---
background-color: #FFFFFF

## Nutrition screening

```{r screen1, echo = FALSE, eval = TRUE, fig.height = 6, fig.width = 8, fig.align = "center"}
screenEst <- read.csv("data/screenEst.csv")
x <- screenEst

x <- x[x$indicator %in% c("muacScreen", "oedemaScreen"), ]

varNames <- c("Child MUAC measured in the past month",
              "Child MUAC measured in the past month",
              "Child checked for oedema in the past month",
              "Child checked for oedema in the past month")

x <- data.frame(x[ , c("county", "indicator")], df = "screenDF", varNames, x[ , c("estimate", "lcl", "ucl")])
names(x)[2] <- "varLabel"

x$county <- ifelse(x$county == "Monrovia", "Greater Monrovia", x$county)
x$varLabel <- c(rep("muac.scren", 2), rep("oedema.screen", 2))

x <- data.frame(round = "Baseline", x)

## Endline data
y <- screenBoot[screenBoot$varLabel %in% c("muac.screen", "oedema.screen"), ]
y$varNames <- rep(unique(varNames), 2)

y <- data.frame(round = "Endline", y)

## Concatenate
screenDF <- data.frame(rbind(x, y))

screenDF$county <- factor(screenDF$county, levels = c("Greater Monrovia", "Grand Bassa"))
screenDF$varNames <- factor(screenDF$varNames, levels = unique(varNames))

ggplot(data = screenDF, mapping = aes(x = round, y = estimate * 100)) +
  geom_col(color = "#85010C", fill = "#85010C", width = 0.7, alpha = 0.7) +
  facet_grid(county ~ varNames) +
  labs(x = "", y = "%") +
  scale_y_continuous(limits = c(0, 100),
                     breaks = seq(from = 0, to = 100, by = 20)) +
  themeSettings +
  theme(strip.text.x = element_text(size = 12))
```
---
background-color: #FFFFFF

## Spatial distribution of nutrition screenin coverage in Greater Monrovia

```{r screen1map, echo = FALSE, eval = TRUE, fig.width = 6, fig.height = 6, fig.align = "center"}
x <- subset(screenBaseGM, select = c(county, screen1, screen2))
x@data <- data.frame(id = row.names(x), round = "Baseline", x@data)
xGeom <- fortify(x)
xGeom <- merge(xGeom, x@data, by = "id")

y <- subset(gmCovHex, select = c(county, muac.screen, oedema.screen))
names(y) <- c("county", "screen1", "screen2")
y@data <- data.frame(id = row.names(y), round = "Endline", y@data)
yGeom <- fortify(y)
yGeom <- merge(yGeom, y@data, by = "id")

xyGeom <- data.frame(rbind(xGeom, yGeom))
xyGeom <- pivot_longer(data = xyGeom, cols = screen1:screen2, names_to = "indicator", values_to = "estimate")

xyGeom$indicator <- factor(x = xyGeom$indicator,
                          labels = c("MUAC measured in the past month",
                                     "Oedema checked in the past month"))

ggplot(data = xyGeom, 
       aes(x = long, y = lat, group = group, fill = estimate)) +
  geom_polygon() +
  scale_fill_gradientn(name = "%",
                       limits = c(0, 1), 
                       breaks = seq(from = 0, to = 1, by = .2),
                       labels = seq(from = 0, to = 100, by = 20),
                       colours = map.palette(101)) +
  scale_x_continuous(limits = bbox(greaterMonroviaEA)[1, ], 
                     breaks = seq(from = bbox(greaterMonroviaEA)[1, 1],
                                  to = bbox(greaterMonroviaEA)[1, 2],
                                  by = 0.01)) +
  scale_y_continuous(limits = bbox(greaterMonroviaEA)[2, ],
                     breaks = seq(from = bbox(greaterMonroviaEA)[2, 1],
                                  to = bbox(greaterMonroviaEA)[2, 2],
                                  by = 0.01)) +
  facet_grid(round ~ indicator) +
  labs(x = "", y = "") +
  themeMapping
```
---
background-color: #FFFFFF

## Spatial distribution of nutrition screening coverage in Grand Bassa

```{r screen2map, echo = FALSE, eval = TRUE, fig.width = 6, fig.height = 6, fig.align = "center"}
x <- subset(screenBaseGB, select = c(county, screen1, screen2))
x@data <- data.frame(id = row.names(x), round = "Baseline", x@data)
xGeom <- fortify(x)
xGeom <- merge(xGeom, x@data, by = "id")

y <- subset(gbCovHex, select = c(county, muac.screen, oedema.screen))
names(y) <- c("county", "screen1", "screen2")
y@data <- data.frame(id = row.names(y), round = "Endline", y@data)
yGeom <- fortify(y)
yGeom <- merge(yGeom, y@data, by = "id")

xyGeom <- data.frame(rbind(xGeom, yGeom))
xyGeom <- pivot_longer(data = xyGeom, cols = screen1:screen2, names_to = "indicator", values_to = "estimate")

xyGeom$indicator <- factor(x = xyGeom$indicator,
                          labels = c("MUAC measured in the past month",
                                     "Oedema checked in the past month"))

ggplot(data = xyGeom, 
       aes(x = long, y = lat, group = group, fill = estimate)) +
  geom_polygon() +
  scale_fill_gradientn(name = "%",
                       limits = c(0, 1), 
                       breaks = seq(from = 0, to = 1, by = .2),
                       labels = seq(from = 0, to = 100, by = 20),
                       colours = map.palette(101)) +
  scale_x_continuous(limits = bbox(grandBassaEA)[1, ], 
                     breaks = seq(from = bbox(grandBassaEA)[1, 1],
                                  to = bbox(grandBassaEA)[1, 2],
                                  by = 0.01)) +
  scale_y_continuous(limits = bbox(grandBassaEA)[2, ],
                     breaks = seq(from = bbox(grandBassaEA)[2, 1],
                                  to = bbox(grandBassaEA)[2, 2],
                                  by = 0.01)) +
  facet_grid(round ~ indicator) +
  labs(x = "", y = "") +
  themeMapping
```
---
background-color: #FFFFFF

## CMAM coverage

```{r cmam1plot, echo = FALSE, eval = TRUE, fig.height = 6, fig.width = 6, fig.align = "center"}
coverageEst <- read.csv("data/coverageEst.csv")

x <- coverageEst
x <- x[x$indicator %in% c("point", "treatment"), ]

varNames <- c("Case-finding effectiveness",
              "Treatment coverage",
              "Case-finding effectiveness",
              "Treatment coverage")

x <- data.frame(x[ , c("county", "indicator")], df = "cmamDF", varNames, x[ , c("estimate", "lcl", "ucl")])
names(x)[2] <- "varLabel"
x$varLabel <- c("cf", "tc", "cf", "tc")
x$county <- ifelse(x$county == "Monrovia", "Greater Monrovia", x$county)
x <- data.frame(round = "Baseline", x)

## Endline data
y <- cmamEst[cmamEst$varLabel %in% c("cf", "tc"), ]
y$varNames <- rep(unique(varNames), 2)

y <- data.frame(round = "Endline", y)

## Concatenate
cmamTable <- data.frame(rbind(x, y))

cmamTable$county <- factor(cmamTable$county, levels = c("Greater Monrovia", "Grand Bassa"))
cmamTable$varNames <- factor(cmamTable$varNames, levels = unique(varNames))

ggplot(data = cmamTable, mapping = aes(x = round, y = estimate * 100)) +
  geom_col(color = "#85010C", fill = "#85010C", width = 0.7, alpha = 0.7) +
  facet_grid(county ~ varNames) +
  labs(x = "", y = "%") +
  scale_y_continuous(limits = c(0, 100),
                     breaks = seq(from = 0, to = 100, by = 20)) +
  themeSettings +
  theme(strip.text.x = element_text(size = 12))
```
---
background-color: #FFFFFF

## Spatial distribution of CMAM coverage in Greater Monrovia

```{r cmamMap1, echo = FALSE, eval = TRUE, fig.width = 6, fig.height = 6, fig.align = "center"}
x <- cmamBaseGM
x$county <- "Greater Monrovia"
names(x) <- c("county", "cf", "tc")
x@data <- data.frame(id = row.names(x), round = "Baseline", x@data)
xGeom <- fortify(x)
xGeom <- merge(xGeom, x@data, by = "id")

y <- subset(gmCovHex, select = c(county, cf, tc))
y$county <- "Greater Monrovia"
y@data <- data.frame(id = row.names(y), round = "Endline", y@data)
yGeom <- fortify(y)
yGeom <- merge(yGeom, y@data, by = "id")

xyGeom <- data.frame(rbind(xGeom, yGeom))
xyGeom <- pivot_longer(data = xyGeom, cols = c(cf, tc), names_to = "indicator", values_to = "estimate")

xyGeom$indicator <- factor(x = xyGeom$indicator,
                            levels = c("cf", "tc"),
                            labels = c("Case-finding effectiveness",
                                       "Treatment coverage"))

ggplot(data = xyGeom, 
       aes(x = long, y = lat, group = group, fill = estimate)) +
  geom_polygon() +
  scale_fill_gradientn(name = "%",
                       limits = c(0, 1), 
                       breaks = seq(from = 0, to = 1, by = .2),
                       labels = seq(from = 0, to = 100, by = 20),
                       colours = map.palette(101)) +
  scale_x_continuous(limits = bbox(greaterMonroviaEA)[1, ], 
                     breaks = seq(from = bbox(greaterMonroviaEA)[1, 1],
                                  to = bbox(greaterMonroviaEA)[1, 2],
                                  by = 0.01)) +
  scale_y_continuous(limits = bbox(greaterMonroviaEA)[2, ],
                     breaks = seq(from = bbox(greaterMonroviaEA)[2, 1],
                                  to = bbox(greaterMonroviaEA)[2, 2],
                                  by = 0.01)) +
  facet_grid(round ~ indicator) +
  labs(x = "", y = "") +
  themeMapping
```
---
background-color: #FFFFFF

## Spatial distribution of CMAM coverage in Grand Bassa

```{r cmamMap2, echo = FALSE, eval = TRUE, fig.width = 6, fig.height = 6, fig.align = "center"}
x <- cmamBaseGB
names(x) <- c("county", "cf", "tc")
x@data <- data.frame(id = row.names(x), round = "Baseline", x@data)
xGeom <- fortify(x)
xGeom <- merge(xGeom, x@data, by = "id")

y <- subset(gbCovHex, select = c(county, cf, tc))
y@data <- data.frame(id = row.names(y), round = "Endline", y@data)
yGeom <- fortify(y)
yGeom <- merge(yGeom, y@data, by = "id")

xyGeom <- data.frame(rbind(xGeom, yGeom))
xyGeom <- pivot_longer(data = xyGeom, cols = c(cf, tc), names_to = "indicator", values_to = "estimate")

xyGeom$indicator <- factor(x = xyGeom$indicator,
                            levels = c("cf", "tc"),
                            labels = c("Case-finding effectiveness",
                                       "Treatment coverage"))

ggplot(data = xyGeom, 
       aes(x = long, y = lat, group = group, fill = estimate)) +
  geom_polygon() +
  scale_fill_gradientn(name = "%",
                       limits = c(0, 1), 
                       breaks = seq(from = 0, to = 1, by = .2),
                       labels = seq(from = 0, to = 100, by = 20),
                       colours = map.palette(101)) +
  scale_x_continuous(limits = bbox(grandBassaEA)[1, ], 
                     breaks = seq(from = bbox(grandBassaEA)[1, 1],
                                  to = bbox(grandBassaEA)[1, 2],
                                  by = 0.01)) +
  scale_y_continuous(limits = bbox(grandBassaEA)[2, ],
                     breaks = seq(from = bbox(grandBassaEA)[2, 1],
                                  to = bbox(grandBassaEA)[2, 2],
                                  by = 0.01)) +
  facet_grid(round ~ indicator) +
  labs(x = "", y = "") +
  themeMapping
```
---
background-color: #FFFFFF

## Reasons for not being in CMAM programme

```{r cmam2plot, echo = FALSE, eval = TRUE, fig.height = 7, fig.width = 12, fig.align = "center"}
barriersEst <- read.csv("data/barriersCount.csv")
x <- barriersEst[barriersEst$indicator %in% c("q2", "q3", paste("q4a.q4", letters[1:18], sep = "")) & barriersEst$county == "Monrovia", ]
x$indicator <- factor(x = x$indicator, labels = c("Mother/carer does not think child is too small/thin",
              "Mother/carer does not know of any treatment",
              "Came to health centre but was not measured",
              "Too far",
              "No time/too busy",
              "Mother/carer is sick",
              "Cannot carry more than one child",
              "Feels ashamed about coming",
              "Security problems",
              "No one else to take care of other siblings",
              "Rejected by programme",
              "Other parents' children have been rejected",
              "Husband refused",
              "Though necessary to be enrolled in hospital first",
              "Does not think programme can help children",
              "Got diarrhoea from RUTF",
              "Ration has worms",
              "Out of stock",
              "Lack of money to pay for transport",
              "SAM case in SFP"))

x <- x[x$count != 0, ]

baselineGM <- ggplot(data = x, aes(x = reorder(indicator, -count), y = count)) +
  geom_col(col = "#993300", fill = alpha("#993300", 0.8), width = 0.7) +
  labs(x = "", y = "Count") +
  scale_y_continuous(limits = c(0, 20), breaks = seq(from = 0, to = 20, by = 4)) +
  coord_flip() +
  themeSettings

x <- colSums(cmamDF[cmamDF$cid == 1, c("q2", "q3", paste("q4", letters[1:18], sep = ""))])
x <- data.frame(county = "Greater Monrovia", indicator = row.names(data.frame(x)), count = x)

x$indicator <- factor(x = x$indicator, labels = c("Mother/carer does not think child is too small/thin",
              "Mother/carer does not know of any treatment",
              "Came to health centre but was not measured",
              "Too far",
              "No time/too busy",
              "Mother/carer is sick",
              "Cannot carry more than one child",
              "Feels ashamed about coming",
              "Security problems",
              "No one else to take care of other siblings",
              "Rejected by programme",
              "Other parents' children have been rejected",
              "Husband refused",
              "Though necessary to be enrolled in hospital first",
              "Does not think programme can help children",
              "Got diarrhoea from RUTF",
              "Ration has worms",
              "Out of stock",
              "Lack of money to pay for transport",
              "SAM case in SFP"))

x <- x[x$count != 0, ]

endlineGM <- ggplot(data = x, aes(x = reorder(indicator, -count), y = count)) +
  geom_col(col = "#993300", fill = alpha("#993300", 0.8), width = 0.7) +
  labs(x = "", y = "Count") +
  scale_y_continuous(limits = c(0, 20), breaks = seq(from = 0, to = 20, by = 4)) + 
  coord_flip() +
  themeSettings

x <- barriersEst[barriersEst$indicator %in% c("q2", "q3", paste("q4a.q4", letters[1:18], sep = "")) & barriersEst$county == "Grand Bassa", ]
x$indicator <- factor(x = x$indicator, labels = c("Mother/carer does not think child is too small/thin",
              "Mother/carer does not know of any treatment",
              "Came to health centre but was not measured",
              "Too far",
              "No time/too busy",
              "Mother/carer is sick",
              "Cannot carry more than one child",
              "Feels ashamed about coming",
              "Security problems",
              "No one else to take care of other siblings",
              "Rejected by programme",
              "Other parents' children have been rejected",
              "Husband refused",
              "Though necessary to be enrolled in hospital first",
              "Does not think programme can help children",
              "Got diarrhoea from RUTF",
              "Ration has worms",
              "Out of stock",
              "Lack of money to pay for transport",
              "SAM case in SFP"))

x <- x[x$count != 0, ]

baselineGB <- ggplot(data = x, aes(x = reorder(indicator, -count), y = count)) +
  geom_col(col = "#993300", fill = alpha("#993300", 0.8), width = 0.7) +
  labs(x = "", y = "Count") +
  scale_y_continuous(limits = c(0, 24), breaks = seq(from = 0, to = 24, by = 4)) +
  coord_flip() +
  themeSettings

x <- colSums(cmamDF[cmamDF$cid == 2, c("q2", "q3", paste("q4", letters[1:18], sep = ""))])
x <- data.frame(county = "Grand Bassa", indicator = row.names(data.frame(x)), count = x)

x$indicator <- factor(x = x$indicator, labels = c("Mother/carer does not think child is too small/thin",
              "Mother/carer does not know of any treatment",
              "Came to health centre but was not measured",
              "Too far",
              "No time/too busy",
              "Mother/carer is sick",
              "Cannot carry more than one child",
              "Feels ashamed about coming",
              "Security problems",
              "No one else to take care of other siblings",
              "Rejected by programme",
              "Other parents' children have been rejected",
              "Husband refused",
              "Though necessary to be enrolled in hospital first",
              "Does not think programme can help children",
              "Got diarrhoea from RUTF",
              "Ration has worms",
              "Out of stock",
              "Lack of money to pay for transport",
              "SAM case in SFP"))

x <- x[x$count != 0, ]

endlineGB <- ggplot(data = x, aes(x = reorder(indicator, -count), y = count)) +
  geom_col(col = "#993300", fill = alpha("#993300", 0.8), width = 0.7) +
  labs(x = "", y = "Count") +
  scale_y_continuous(limits = c(0, 24), breaks = seq(from = 0, to = 24, by = 4)) + 
  coord_flip() +
  themeSettings

plot_grid(baselineGM, endlineGM, baselineGB, endlineGB,
          nrow = 2, ncol = 2,
          labels = c("Baseline - Greater Monrovia", "Endline - Greater Monrovia",
                     "Baseline - Grand Bassa", "Endline - Grand Bassa"),
          label_size = 12, label_colour = "#247BA0", 
          hjust = c(-1.4, -1.5, -1.85, -2),
          vjust = 1)
```
